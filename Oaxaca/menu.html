<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Menu - Oaxaca</title>
  <link rel="stylesheet" href="style.css" type="text/css">
  <script type="text/javascript" src="menu.js"></script>

</head>

<body>
  <div id="container">
    <div id="headerArea">
      <div id="header"></div>

      <nav id="navbar">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="menu.html">Menu</a></li>
          <li><a href="order.html#">Order</a></li>
          <li><a href="#">Link</a></li>
          <li><a href="#">Link</a></li>
        </ul>
      </nav>
    </div>

    <div id="flex">

      <aside id="leftSidebar">

        <h2 id="menuTitle">Menu Filters</h2>

        <div class="box">

          <div id="menuFilter">
            <div class="filterOption">
              <label for="searchTerm">Search Item:</label>
              <input type="text" id="searchTerm" placeholder="Enter item name">
            </div>

            <div class="filterOption">
              <label for="maxCalories">Max Calories:</label>
              <input type="number" id="maxCalories" placeholder="Enter max calories">
            </div>

            <div class="filterOption">
              <label for="maxPrice">Max Price:</label>
              <input type="number" id="maxPrice" placeholder="Enter max price">
            </div>

            <button onclick="applyFilter()" class="filterButton">Apply Filter</button>
            <button onclick="resetFilter()" class="filterButton">Reset Filter</button>

            <div class="filterOption" id="categoryFilter">
              <label for="categoryFilter">Category:</label>
              <button onclick="filterMenuByCategory('all', this)" data-category="all" class="active">Show All</button>
            </div>
          </div>

        </div>

        <div>
          <p>
            <button onclick="editMenu()">Edit Menu</button>
          </p>
        </div>

      </aside> <!--Above section is in sidebar for cleaner presentation-->

      <main id="menuPage"> <!--Main section of page-->
        <div class="menuSection">
          <section class="appetizersSection" data-calories="200" data-price="10.00">
            <h2>Dishes & Drinks</h2>
            <div id="MenuItemGridLayout">

            </div>
            <div id="MenuEditSection">

            </div>
          </section>
          <div id="basketIcon" onclick="goToOrderPage()">ðŸ›’ 0</div>


        </div>
      </main>

    </div>

    <footer id="footer">
      <a href="#">Work with us</a>&emsp;
      <a href="#">Get in touch</a>&emsp;
      <a href="#">Privacy policy</a>
    </footer>

  </div>

  <script>

    function goToOrderPage() {
      window.location.href = "order.html";
    }

    document.addEventListener("DOMContentLoaded", function () {
      initializeMenu();
      initializeCategoryFilter();
      //initMenuAll()
    });


    function initializeMenu() {
      const activeButton = document.querySelector('#menuFilter button.active');

      if (activeButton) {
        const category = activeButton.getAttribute('data-category');
        const filter = {
          searchTerm: '',
          maxCalories: 0,
          maxPrice: 0,
          category: category
        };
        filterMenu(filter, activeButton);
      } else {
        applyFilter();
      }
    }



    function applyFilter() {
      const searchTerm = document.getElementById('searchTerm').value.toLowerCase();
      const maxCalories = parseInt(document.getElementById('maxCalories').value) || 0;
      const maxPrice = parseFloat(document.getElementById('maxPrice').value) || 0;

      const filter = {
        searchTerm: searchTerm,
        maxCalories: maxCalories,
        maxPrice: maxPrice,
        category: 'all'
      };

      filterMenu(filter, document.querySelector('#menuFilter button.filterButton'));
      showFilterFeedback();
    }

    function resetFilter() {
      document.getElementById('searchTerm').value = '';
      document.getElementById('maxCalories').value = '';
      document.getElementById('maxPrice').value = '';

      applyFilter();
    }

    function filterMenu(filter, button) {
      const sections = document.querySelectorAll('.menuSection section');
      const buttons = document.querySelectorAll('#menuFilter button.filterButton');

      buttons.forEach(btn => {
        btn.classList.remove('active');
      });

      button.classList.add('active');

      sections.forEach(section => {
        const sectionClass = section.classList[0];
        const sectionTitle = section.querySelector('h2');
        const listItems = section.querySelectorAll('ul li');

        let sectionMatch = false;

        listItems.forEach(item => {
          const itemName = item.innerText.toLowerCase();
          const itemCalories = parseInt(item.dataset.calories) || 0;
          const itemPrice = parseFloat(item.dataset.price) || 0;

          if (
            (filter.searchTerm === '' || itemName.includes(filter.searchTerm.toLowerCase())) &&
            (filter.maxCalories === 0 || itemCalories <= filter.maxCalories) &&
            (filter.maxPrice === 0 || itemPrice <= filter.maxPrice) &&
            (filter.category === 'all' || sectionClass === filter.category)
          ) {
            sectionMatch = true;
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });

        if (sectionMatch) {
          section.style.display = 'block';
          sectionTitle.style.display = 'block';
        } else {
          section.style.display = 'none';
          sectionTitle.style.display = 'none';
        }
      });
    }

    function initializeCategoryFilter() {
      const activeButton = document.querySelector('#menuFilter button.active');
      if (activeButton) {
        const category = activeButton.getAttribute('data-category');
        filterMenuByCategory(category, activeButton);
      }
    }

    function filterMenuByCategory(category, button) {
      initMenuAll()
      const sections = document.querySelectorAll('.menuSection section');
      const buttons = document.querySelectorAll('#menuFilter button.filterButton');

      buttons.forEach(btn => {
        btn.classList.remove('active');
      });

      button.classList.add('active');

      sections.forEach(section => {
        const sectionClass = section.classList[0];

        if (category === 'all' || sectionClass === category) {
          section.style.display = 'block';
        } else {
          section.style.display = 'none';
        }
      });
    }
  </script>
</body>

</html>